syntax = "proto3";

package binui;

// Library

message Library {
  int32 id = 1;
  string name = 2;
  optional string documentation = 3;
  Version version = 4;
  repeated VariableCollection variables = 5;
  repeated Component components = 6;
  repeated VisualNode visualNodes = 7;
}

message Version {
  int32 major = 1;
  int32 minor = 2;
  int32 patch = 3;
}

// Components

message ComponentProperty {
  int32 id = 1;
  string name = 2;
  optional string documentation = 3;
  Value defaultValue = 4;
}

message ComponentVariantValueDefinition {
  int32 id = 1;
  string name = 2;
  optional string documentation = 3;
}

message ComponentVariantDefinition {
  int32 id = 1;
  string name = 2;
  optional string documentation = 3;
  repeated ComponentVariantValueDefinition values = 4;
}

message ComponentVariantValue {
  int32 variantId = 1;
  int32 id = 2;
}

message ComponentVariant {
  int32 id = 1;
  string name = 2;
  optional string documentation = 3;
  repeated ComponentVariantValue variants = 4;
  VisualNode root = 5;
}

message Component {
  int32 id = 1;
  string name = 2;
  optional string documentation = 3;
  repeated ComponentProperty properties = 4;
  repeated ComponentVariantDefinition variantDefinitions = 5;
  repeated ComponentVariant variants = 6;
}

// Variable collections

message VariableCollection {
  int32 id = 1;
  string name = 2;
  optional string documentation = 3;
  repeated VariableCollectionEntry variables = 4; 
  repeated VariableCollectionVariant variants = 5;
}

message VariableCollectionEntry {
  int32 id = 1;
  string name = 2;
  optional string documentation = 3;
}

message VariableCollectionVariant {
  int32 id = 1;
  string name = 2;
  optional string documentation = 3;
  repeated Value values = 4; // Also defines the type
}

// Values

message Value {
  oneof type{
    Alias alias = 1;
    string stringValue = 2;
    double doubleValue = 3;
    bool boolean = 4;
    Size size = 5;
    Color color = 6;
    Border border = 7;
    BorderSide borderSide = 8;
    Gradient gradient = 9;
    Instance instance = 10;
    Label label = 11;
    Offset offset = 12;
    Radius radius = 13;
    BorderRadius borderRadius = 14;
    Rect rect = 15;
    TextStyle textStyle = 16;
    Transform2D transform2D = 17;
    VariantValue variantValue = 18;
    VectorGraphics vectorGraphics = 19;
    Version version = 20;
    VisualNode visualNode = 21;
  }
}

// Alias

message Alias {
  oneof type {
    ConstantAlias constant = 1;
    PropertyAlias property = 2;
    VariableAlias variable = 3;
  }
}

message ConstantAlias {
  Value value = 1;
}

message VariableAlias {
  int32 collectionId = 1;
  int32 variableId = 2;
  Value defaultValue = 3;
}

message PropertyAlias {
  string name = 1;
  Value defaultValue = 2;
}

// Base

message Size {
  double width = 1;
  double height = 2;
}

enum ColorSpace {
  srgb = 0;
  extendedSrgb = 1;
  displayP3 = 2;
}

message Color {
  double red = 1;
  double green = 2;
  double blue = 3;
  double alpha = 4;
  ColorSpace colorSpace = 5;
}

message Offset {
  double x = 1;
  double y = 2;
}

message Radius {
  double x = 1;
  double y = 2;
}

message BorderRadius {
  Radius topLeft = 1;
  Radius topRight = 2;
  Radius bottomRight = 3;
  Radius bottomLeft = 4;
}

message Rect {
  Offset position = 1;
  Size size = 2;
}

// Border

message BorderSide {
  Color color = 1;
  double width = 2;
  double strokeAlign = 3;
}

message Border {
  BorderSide top = 1;
  BorderSide right = 2;
  BorderSide bottom = 3;
  BorderSide left = 4;
}

// Gradients

message GradientStop {
  double offset = 1;
  Color color = 2;
}

message Gradient {
  oneof type {
    LinearGradient linear = 1;
    RadialGradient radial = 2;
  }
}

message LinearGradient {
  repeated GradientStop stops = 1;
  Offset begin = 2;
  Offset end = 3;
}

message RadialGradient {
  repeated GradientStop stops = 1;
  Offset center = 2;
  double radius = 3;
}

// Instance

message Instance {
  string type = 1;
  repeated InstanceArgument arguments = 2;
}

message InstanceArgument {
  string name = 1;
  Value value = 2;
}

// Label

message Label {
  LabelSegment segment = 1;
  repeated LabelVariable variables = 2;
}

message LabelVariable {
  int32 id = 1;
  LabelVariableType variableType = 2;
}

enum LabelVariableType {
  string_type = 0;
  number_type = 1;
}

message LabelSegment {
  oneof type {
    StyledSegment styled = 1;
    StaticSegment static = 2;
    VariableSegment variable = 3;
  }
}

message StyledSegment {
  LabelStyle style = 1;
  Label child = 2;
}

message StaticSegment {
  string text = 1;
}

message VariableSegment {
  int32 variableId = 1;
}

enum LabelStyle {
  none = 0;
  bold = 1;
  italic = 2;
  underlined = 3;
}

// Text Style

message FontVariation {
  string axis = 1;
  double value = 2;
}

message TextStyle {
  string fontFamily = 1;
  double fontSize = 2;
  int32 fontWeight = 3;
  double letterSpacing = 4;
  double wordSpacing = 5;
  double lineHeight = 6;
  repeated FontVariation fontVariations = 7;
}

// Transform

message Transform2D {
  repeated MatrixRow rows = 1;
}

message MatrixRow {
  repeated double values = 1;
}

// Variant Value

message VariantValue {
  string component = 1;
  string type = 2;
  string value = 3;
}

// Vector Graphics

message VectorGraphics {
  oneof type {
    SvgVectorGraphics svg = 1;
  }
}

message SvgVectorGraphics {
  string data = 1;
  Rect viewBox = 2;
}

// Version

message Version {
  int32 major = 1;
  int32 minor = 2;
  int32 patch = 3;
}

// Visual Node

message VisualNode {
  oneof type {
    FrameNode frame = 1;
    GroupNode group = 2;
    RectangleNode rectangle = 3;
    EllipseNode ellipse = 4;
    LineNode line = 5;
    VectorNode vector = 6;
    TextNode text = 7;
    ComponentNode component = 8;
    InstanceNode instance = 9;
    BooleanOperationNode booleanOperation = 10;
  }
}

enum BlendMode {
  passThrough = 0;
  normal = 1;
  darken = 2;
  multiply = 3;
  linearBurn = 4;
  colorBurn = 5;
  lighten = 6;
  screen = 7;
  linearDodge = 8;
  colorDodge = 9;
  overlay = 10;
  softLight = 11;
  hardLight = 12;
  difference = 13;
  exclusion = 14;
  hue = 15;
  saturation = 16;
  color = 17;
  luminosity = 18;
}

message Paint {
  oneof type {
    SolidPaint solid = 1;
    GradientPaint gradient = 2;
    ImagePaint image = 3;
  }
  bool visible = 4;
  double opacity = 5;
  BlendMode blendMode = 6;
}

message SolidPaint {
  Alias color = 1;
}

message GradientPaint {
  GradientType type = 1;
  Transform2D gradientTransform = 2;
  repeated ColorStop gradientStops = 3;
}

enum GradientType {
  linear = 0;
  radial = 1;
  angular = 2;
  diamond = 3;
}

message ColorStop {
  double position = 1;
  Alias color = 2;
}

message ImagePaint {
  ScaleMode scaleMode = 1;
  optional string imageHash = 2;
  optional Transform2D imageTransform = 3;
  optional double scalingFactor = 4;
  optional double rotation = 5;
}

enum ScaleMode {
  fill = 0;
  fit = 1;
  crop = 2;
  tile = 3;
}

message Effect {
  oneof type {
    DropShadowEffect dropShadow = 1;
    InnerShadowEffect innerShadow = 2;
    BlurEffect blur = 3;
  }
  bool visible = 4;
}

message DropShadowEffect {
  Alias color = 1;
  Offset offset = 2;
  double radius = 3;
  optional double spread = 4;
  BlendMode blendMode = 5;
  optional bool showShadowBehindNode = 6;
}

message InnerShadowEffect {
  Alias color = 1;
  Offset offset = 2;
  double radius = 3;
  optional double spread = 4;
  BlendMode blendMode = 5;
}

message BlurEffect {
  BlurType type = 1;
  double radius = 2;
}

enum BlurType {
  layer = 0;
  background = 1;
}

enum StrokeCap {
  none = 0;
  round = 1;
  square = 2;
  arrowLines = 3;
  arrowEquilateral = 4;
  diamondFilled = 5;
  triangleFilled = 6;
  circleFilled = 7;
}

enum StrokeJoin {
  miter = 0;
  bevel = 1;
  round = 2;
}

enum StrokeAlign {
  center = 0;
  inside = 1;
  outside = 2;
}

message LayoutConstraints {
  ConstraintType horizontal = 1;
  ConstraintType vertical = 2;
}

enum ConstraintType {
  min = 0;
  center = 1;
  max = 2;
  stretch = 3;
  scale = 4;
}

message FrameNode {
  string id = 1;
  string name = 2;
  bool visible = 3;
  double x = 4;
  double y = 5;
  double width = 6;
  double height = 7;
  Transform2D relativeTransform = 8;
  Transform2D absoluteTransform = 9;
  optional Rect absoluteBoundingBox = 10;
  double rotation = 11;
  optional LayoutConstraints constraints = 12;
  repeated VisualNode children = 13;
  repeated Paint fills = 14;
  repeated Paint strokes = 15;
  Alias strokeWeight = 16;
  bool clipsContent = 17;
  Alias opacity = 18;
  BlendMode blendMode = 19;
  repeated Effect effects = 20;
  optional Alias cornerRadius = 21;
  LayoutMode layoutMode = 22;
  optional Alias paddingLeft = 23;
  optional Alias paddingRight = 24;
  optional Alias paddingTop = 25;
  optional Alias paddingBottom = 26;
  optional Alias itemSpacing = 27;
}

enum LayoutMode {
  none = 0;
  horizontal = 1;
  vertical = 2;
  grid = 3;
}

message GroupNode {
  string id = 1;
  string name = 2;
  bool visible = 3;
  double x = 4;
  double y = 5;
  double width = 6;
  double height = 7;
  Transform2D relativeTransform = 8;
  Transform2D absoluteTransform = 9;
  optional Rect absoluteBoundingBox = 10;
  double rotation = 11;
  optional LayoutConstraints constraints = 12;
  repeated VisualNode children = 13;
  Alias opacity = 14;
  BlendMode blendMode = 15;
}

message RectangleNode {
  string id = 1;
  string name = 2;
  bool visible = 3;
  double x = 4;
  double y = 5;
  double width = 6;
  double height = 7;
  Transform2D relativeTransform = 8;
  Transform2D absoluteTransform = 9;
  optional Rect absoluteBoundingBox = 10;
  double rotation = 11;
  optional LayoutConstraints constraints = 12;
  Alias opacity = 13;
  BlendMode blendMode = 14;
  bool isMask = 15;
  repeated Effect effects = 16;
  repeated Paint fills = 17;
  repeated Paint strokes = 18;
  Alias strokeWeight = 19;
  StrokeCap strokeCap = 20;
  StrokeJoin strokeJoin = 21;
  StrokeAlign strokeAlign = 22;
  optional Alias cornerRadius = 23;
  optional Alias topLeftRadius = 24;
  optional Alias topRightRadius = 25;
  optional Alias bottomLeftRadius = 26;
  optional Alias bottomRightRadius = 27;
}

message EllipseNode {
  string id = 1;
  string name = 2;
  bool visible = 3;
  double x = 4;
  double y = 5;
  double width = 6;
  double height = 7;
  Transform2D relativeTransform = 8;
  Transform2D absoluteTransform = 9;
  optional Rect absoluteBoundingBox = 10;
  double rotation = 11;
  optional LayoutConstraints constraints = 12;
  Alias opacity = 13;
  BlendMode blendMode = 14;
  bool isMask = 15;
  repeated Effect effects = 16;
  repeated Paint fills = 17;
  repeated Paint strokes = 18;
  Alias strokeWeight = 19;
  StrokeCap strokeCap = 20;
  StrokeJoin strokeJoin = 21;
  StrokeAlign strokeAlign = 22;
  optional Alias cornerRadius = 23;
}

message LineNode {
  string id = 1;
  string name = 2;
  bool visible = 3;
  double x = 4;
  double y = 5;
  double width = 6;
  double height = 7;
  Transform2D relativeTransform = 8;
  Transform2D absoluteTransform = 9;
  optional Rect absoluteBoundingBox = 10;
  double rotation = 11;
  optional LayoutConstraints constraints = 12;
  Alias opacity = 13;
  BlendMode blendMode = 14;
  bool isMask = 15;
  repeated Effect effects = 16;
  repeated Paint fills = 17;
  repeated Paint strokes = 18;
  Alias strokeWeight = 19;
  StrokeCap strokeCap = 20;
  StrokeJoin strokeJoin = 21;
  StrokeAlign strokeAlign = 22;
}

message VectorNode {
  string id = 1;
  string name = 2;
  bool visible = 3;
  double x = 4;
  double y = 5;
  double width = 6;
  double height = 7;
  Transform2D relativeTransform = 8;
  Transform2D absoluteTransform = 9;
  optional Rect absoluteBoundingBox = 10;
  double rotation = 11;
  optional LayoutConstraints constraints = 12;
  Alias opacity = 13;
  BlendMode blendMode = 14;
  bool isMask = 15;
  repeated Effect effects = 16;
  repeated Paint fills = 17;
  repeated Paint strokes = 18;
  Alias strokeWeight = 19;
  StrokeCap strokeCap = 20;
  StrokeJoin strokeJoin = 21;
  StrokeAlign strokeAlign = 22;
  optional Alias cornerRadius = 23;
}

message TextNode {
  string id = 1;
  string name = 2;
  bool visible = 3;
  double x = 4;
  double y = 5;
  double width = 6;
  double height = 7;
  Transform2D relativeTransform = 8;
  Transform2D absoluteTransform = 9;
  optional Rect absoluteBoundingBox = 10;
  double rotation = 11;
  optional LayoutConstraints constraints = 12;
  Alias opacity = 13;
  BlendMode blendMode = 14;
  bool isMask = 15;
  repeated Effect effects = 16;
  repeated Paint fills = 17;
  repeated Paint strokes = 18;
  Alias strokeWeight = 19;
  StrokeCap strokeCap = 20;
  StrokeJoin strokeJoin = 21;
  StrokeAlign strokeAlign = 22;
  Alias characters = 23;
  TextAlignHorizontal textAlignHorizontal = 24;
  TextAlignVertical textAlignVertical = 25;
  Alias fontSize = 26;
  string fontFamily = 27;
  string fontStyle = 28;
  int32 fontWeight = 29;
  optional double lineHeight = 30;
  optional double letterSpacing = 31;
}

enum TextAlignHorizontal {
  left = 0;
  center = 1;
  right = 2;
  justified = 3;
}

enum TextAlignVertical {
  top = 0;
  center_v = 1;
  bottom = 2;
}

message ComponentNode {
  string id = 1;
  string name = 2;
  bool visible = 3;
  double x = 4;
  double y = 5;
  double width = 6;
  double height = 7;
  Transform2D relativeTransform = 8;
  Transform2D absoluteTransform = 9;
  optional Rect absoluteBoundingBox = 10;
  double rotation = 11;
  optional LayoutConstraints constraints = 12;
  repeated VisualNode children = 13;
  repeated Paint fills = 14;
  repeated Paint strokes = 15;
  Alias strokeWeight = 16;
  bool clipsContent = 17;
  Alias opacity = 18;
  BlendMode blendMode = 19;
  repeated Effect effects = 20;
  optional Alias cornerRadius = 21;
  LayoutMode layoutMode = 22;
  optional Alias paddingLeft = 23;
  optional Alias paddingRight = 24;
  optional Alias paddingTop = 25;
  optional Alias paddingBottom = 26;
  optional Alias itemSpacing = 27;
}

message InstanceNode {
  string id = 1;
  string name = 2;
  bool visible = 3;
  double x = 4;
  double y = 5;
  double width = 6;
  double height = 7;
  Transform2D relativeTransform = 8;
  Transform2D absoluteTransform = 9;
  optional Rect absoluteBoundingBox = 10;
  double rotation = 11;
  optional LayoutConstraints constraints = 12;
  repeated VisualNode children = 13;
  repeated Paint fills = 14;
  repeated Paint strokes = 15;
  Alias strokeWeight = 16;
  bool clipsContent = 17;
  Alias opacity = 18;
  BlendMode blendMode = 19;
  repeated Effect effects = 20;
  optional Alias cornerRadius = 21;
  LayoutMode layoutMode = 22;
  optional Alias paddingLeft = 23;
  optional Alias paddingRight = 24;
  optional Alias paddingTop = 25;
  optional Alias paddingBottom = 26;
  optional Alias itemSpacing = 27;
  optional string mainComponentId = 28;
}

message BooleanOperationNode {
  string id = 1;
  string name = 2;
  bool visible = 3;
  double x = 4;
  double y = 5;
  double width = 6;
  double height = 7;
  Transform2D relativeTransform = 8;
  Transform2D absoluteTransform = 9;
  optional Rect absoluteBoundingBox = 10;
  double rotation = 11;
  optional LayoutConstraints constraints = 12;
  repeated VisualNode children = 13;
  BooleanOperation booleanOperation = 14;
  repeated Paint fills = 15;
  repeated Paint strokes = 16;
  Alias strokeWeight = 17;
  Alias opacity = 18;
  BlendMode blendMode = 19;
  repeated Effect effects = 20;
}

enum BooleanOperation {
  union = 0;
  intersect = 1;
  subtract = 2;
  exclude = 3;
}
