syntax = "proto3";

package binui;

// Library

message Library {
  int32 id = 1;
  string name = 2;
  optional string documentation = 3;
  Version version = 4;
  repeated VariableCollection variables = 5;
  repeated Component components = 6;
}

message Version {
  int32 major = 1;
  int32 minor = 2;
  int32 patch = 3;
}

// Components

message ComponentProperty {
  int32 componentId = 1;
  int32 id = 2;
  string name = 3;
  optional string documentation = 4;
  Value defaultValue = 5;
}

message ComponentVariantValueDefinition {
  int32 id = 1;
  string name = 2;
  optional string documentation = 3;
}

message ComponentVariantDefinition {
  int32 id = 1;
  string name = 2;
  optional string documentation = 3;
  repeated ComponentVariantValueDefinition values = 4;
}

message ComponentVariantValue {
  int32 componentId = 1;
  int32 variantId = 2;
  int32 id = 3;
}

message ComponentVariant {
  int32 id = 1;
  string name = 2;
  optional string documentation = 3;
  repeated ComponentVariantValue variants = 4;
  VisualNode root = 5;
}

message Component {
  int32 id = 1;
  string name = 2;
  optional string documentation = 3;
  repeated ComponentProperty properties = 4;
  repeated ComponentVariantDefinition variantDefinitions = 5;
  repeated ComponentVariant variants = 6;
}

// Variable collections

message VariableCollection {
  int32 id = 1;
  string name = 2;
  optional string documentation = 3;
  repeated VariableCollectionEntry variables = 4; 
  repeated VariableCollectionVariant variants = 5;
}

message VariableCollectionEntry {
  int32 id = 1;
  string name = 2;
  optional string documentation = 3;
}

message VariableCollectionVariant {
  int32 id = 1;
  string name = 2;
  optional string documentation = 3;
  repeated Value values = 4; // Also defines the type
}

// Values

message Value {
  oneof type{
    Alias alias = 1;
    string stringValue = 2;
    double doubleValue = 3;
    bool boolean = 4;
    Size size = 5;
    Color color = 6;
    Border border = 7;
    BorderSide borderSide = 8;
    Gradient gradient = 9;
    Label label = 11;
    Offset offset = 12;
    Radius radius = 13;
    CornerRadius borderRadius = 14;
    Rect rect = 15;
    TextStyle textStyle = 16;
    Transform transform = 17;
    VariantValue variantValue = 18;
    VectorGraphics vectorGraphics = 19;
    Version version = 20;
    VisualNode visualNode = 21;
  }
}

// Alias

message Alias {
  oneof type {
    ConstantAlias constant = 1;
    PropertyAlias property = 2;
    VariableAlias variable = 3;
  }
}

message ConstantAlias {
  Value value = 1;
}

message VariableAlias {
  int32 collectionId = 1;
  int32 variableId = 2;
  Value defaultValue = 3;
}

message PropertyAlias {
  int32 componentId = 1;
  int32 propertyId = 2;
  Value defaultValue = 3;
}

// ============================================================================
// Geometry Types
// ============================================================================

message Size {
  double width = 1;
  double height = 2;
}

message Offset {
  double x = 1;
  double y = 2;
}

message Radius {
  double x = 1;
  double y = 2;
}

message Rect {
  Offset position = 1;
  Size size = 2;
}

message EdgeInsets {
  double left = 1;
  double top = 2;
  double right = 3;
  double bottom = 4;
}

// Transform - 2D affine transformation matrix (2x3)
message Transform {
  double m00 = 1;
  double m01 = 2;
  double m02 = 3;
  double m10 = 4;
  double m11 = 5;
  double m12 = 6;
}

message ArcData {
  double startingAngle = 1;
  double endingAngle = 2;
  double innerRadius = 3;
}

// ============================================================================
// Color Types
// ============================================================================

enum ColorSpace {
  COLOR_SPACE_SRGB = 0;
  COLOR_SPACE_EXTENDED_SRGB = 1;
  COLOR_SPACE_DISPLAY_P3 = 2;
}

message Color {
  double red = 1;
  double green = 2;
  double blue = 3;
  double alpha = 4;
  ColorSpace colorSpace = 5;
}

// ============================================================================
// Corner Radius
// ============================================================================

message CornerRadius {
  double topLeft = 1;
  double topRight = 2;
  double bottomLeft = 3;
  double bottomRight = 4;
  double smoothing = 5; // 0-1, for squircle corners
}

// ============================================================================
// Border Types
// ============================================================================

message BorderSide {
  double width = 1;
  double strokeAlign = 2;
}

message Border {
  BorderSide top = 1;
  BorderSide right = 2;
  BorderSide bottom = 3;
  BorderSide left = 4;
}

// ============================================================================
// Enums - Common
// ============================================================================

enum BlendMode {
  BLEND_MODE_PASS_THROUGH = 0;
  BLEND_MODE_NORMAL = 1;
  BLEND_MODE_DARKEN = 2;
  BLEND_MODE_MULTIPLY = 3;
  BLEND_MODE_LINEAR_BURN = 4;
  BLEND_MODE_COLOR_BURN = 5;
  BLEND_MODE_LIGHTEN = 6;
  BLEND_MODE_SCREEN = 7;
  BLEND_MODE_LINEAR_DODGE = 8;
  BLEND_MODE_COLOR_DODGE = 9;
  BLEND_MODE_OVERLAY = 10;
  BLEND_MODE_SOFT_LIGHT = 11;
  BLEND_MODE_HARD_LIGHT = 12;
  BLEND_MODE_DIFFERENCE = 13;
  BLEND_MODE_EXCLUSION = 14;
  BLEND_MODE_HUE = 15;
  BLEND_MODE_SATURATION = 16;
  BLEND_MODE_COLOR = 17;
  BLEND_MODE_LUMINOSITY = 18;
}

enum MaskType {
  MASK_TYPE_ALPHA = 0;
  MASK_TYPE_VECTOR = 1;
  MASK_TYPE_LUMINANCE = 2;
}

enum ConstraintType {
  CONSTRAINT_TYPE_MIN = 0;
  CONSTRAINT_TYPE_CENTER = 1;
  CONSTRAINT_TYPE_MAX = 2;
  CONSTRAINT_TYPE_STRETCH = 3;
  CONSTRAINT_TYPE_SCALE = 4;
}

// ============================================================================
// Enums - Stroke
// ============================================================================

enum StrokeCap {
  STROKE_CAP_NONE = 0;
  STROKE_CAP_ROUND = 1;
  STROKE_CAP_SQUARE = 2;
  STROKE_CAP_ARROW_LINES = 3;
  STROKE_CAP_ARROW_EQUILATERAL = 4;
  STROKE_CAP_DIAMOND_FILLED = 5;
  STROKE_CAP_TRIANGLE_FILLED = 6;
  STROKE_CAP_CIRCLE_FILLED = 7;
}

enum StrokeJoin {
  STROKE_JOIN_MITER = 0;
  STROKE_JOIN_BEVEL = 1;
  STROKE_JOIN_ROUND = 2;
}

enum StrokeAlign {
  STROKE_ALIGN_CENTER = 0;
  STROKE_ALIGN_INSIDE = 1;
  STROKE_ALIGN_OUTSIDE = 2;
}

// ============================================================================
// Enums - Vector
// ============================================================================

enum HandleMirroring {
  HANDLE_MIRRORING_NONE = 0;
  HANDLE_MIRRORING_ANGLE = 1;
  HANDLE_MIRRORING_ANGLE_AND_LENGTH = 2;
}

enum WindingRule {
  WINDING_RULE_NONZERO = 0;
  WINDING_RULE_EVENODD = 1;
}

enum ConnectorMagnet {
  CONNECTOR_MAGNET_NONE = 0;
  CONNECTOR_MAGNET_AUTO = 1;
  CONNECTOR_MAGNET_TOP = 2;
  CONNECTOR_MAGNET_LEFT = 3;
  CONNECTOR_MAGNET_BOTTOM = 4;
  CONNECTOR_MAGNET_RIGHT = 5;
  CONNECTOR_MAGNET_CENTER = 6;
}

enum ConnectorStrokeCap {
  CONNECTOR_STROKE_CAP_NONE = 0;
  CONNECTOR_STROKE_CAP_ARROW_EQUILATERAL = 1;
  CONNECTOR_STROKE_CAP_ARROW_LINES = 2;
  CONNECTOR_STROKE_CAP_TRIANGLE_FILLED = 3;
  CONNECTOR_STROKE_CAP_DIAMOND_FILLED = 4;
  CONNECTOR_STROKE_CAP_CIRCLE_FILLED = 5;
}

// ============================================================================
// Enums - Layout
// ============================================================================

enum ScaleMode {
  SCALE_MODE_FILL = 0;
  SCALE_MODE_FIT = 1;
  SCALE_MODE_CROP = 2;
  SCALE_MODE_TILE = 3;
}

enum OverflowDirection {
  OVERFLOW_DIRECTION_NONE = 0;
  OVERFLOW_DIRECTION_HORIZONTAL = 1;
  OVERFLOW_DIRECTION_VERTICAL = 2;
  OVERFLOW_DIRECTION_BOTH = 3;
}

enum OverlayPositionType {
  OVERLAY_POSITION_CENTER = 0;
  OVERLAY_POSITION_TOP_LEFT = 1;
  OVERLAY_POSITION_TOP_CENTER = 2;
  OVERLAY_POSITION_TOP_RIGHT = 3;
  OVERLAY_POSITION_BOTTOM_LEFT = 4;
  OVERLAY_POSITION_BOTTOM_CENTER = 5;
  OVERLAY_POSITION_BOTTOM_RIGHT = 6;
  OVERLAY_POSITION_MANUAL = 7;
}

enum LayoutMode {
  LAYOUT_MODE_FREEFORM = 0;
  LAYOUT_MODE_HORIZONTAL = 1;
  LAYOUT_MODE_VERTICAL = 2;
  LAYOUT_MODE_GRID = 3;
}

enum PrimaryAxisSizingMode {
  PRIMARY_AXIS_SIZING_FIXED = 0;
  PRIMARY_AXIS_SIZING_AUTO = 1;
}

enum CounterAxisSizingMode {
  COUNTER_AXIS_SIZING_FIXED = 0;
  COUNTER_AXIS_SIZING_AUTO = 1;
}

enum LayoutWrap {
  LAYOUT_WRAP_NO_WRAP = 0;
  LAYOUT_WRAP_WRAP = 1;
}

enum LayoutAlign {
  LAYOUT_ALIGN_MIN = 0;
  LAYOUT_ALIGN_CENTER = 1;
  LAYOUT_ALIGN_MAX = 2;
  LAYOUT_ALIGN_STRETCH = 3;
  LAYOUT_ALIGN_SPACE_BETWEEN = 4;
}

enum ChildSizingMode {
  CHILD_SIZING_FIXED = 0;
  CHILD_SIZING_HUG = 1;
}

enum GridTrackSizingMode {
  GRID_TRACK_SIZING_AUTO = 0;
  GRID_TRACK_SIZING_FIXED = 1;
}

enum PositioningMode {
  POSITIONING_MODE_AUTO = 0;
  POSITIONING_MODE_ABSOLUTE = 1;
}

// ============================================================================
// Enums - Text
// ============================================================================

enum TextAlignHorizontal {
  TEXT_ALIGN_HORIZONTAL_LEFT = 0;
  TEXT_ALIGN_HORIZONTAL_CENTER = 1;
  TEXT_ALIGN_HORIZONTAL_RIGHT = 2;
  TEXT_ALIGN_HORIZONTAL_JUSTIFIED = 3;
}

enum TextAlignVertical {
  TEXT_ALIGN_VERTICAL_TOP = 0;
  TEXT_ALIGN_VERTICAL_CENTER = 1;
  TEXT_ALIGN_VERTICAL_BOTTOM = 2;
}

enum TextCase {
  TEXT_CASE_ORIGINAL = 0;
  TEXT_CASE_UPPER = 1;
  TEXT_CASE_LOWER = 2;
  TEXT_CASE_TITLE = 3;
  TEXT_CASE_SMALL_CAPS = 4;
  TEXT_CASE_SMALL_CAPS_FORCED = 5;
}

enum TextDecoration {
  TEXT_DECORATION_NONE = 0;
  TEXT_DECORATION_UNDERLINE = 1;
  TEXT_DECORATION_STRIKETHROUGH = 2;
}

enum TextDecorationStyle {
  TEXT_DECORATION_STYLE_SOLID = 0;
  TEXT_DECORATION_STYLE_WAVY = 1;
  TEXT_DECORATION_STYLE_DOTTED = 2;
}

enum FontStyle {
  FONT_STYLE_REGULAR = 0;
  FONT_STYLE_ITALIC = 1;
}

enum LetterSpacingUnit {
  LETTER_SPACING_PIXELS = 0;
  LETTER_SPACING_PERCENT = 1;
}

enum LeadingTrim {
  LEADING_TRIM_CAP_HEIGHT = 0;
  LEADING_TRIM_NONE = 1;
}

enum TextListType {
  TEXT_LIST_ORDERED = 0;
  TEXT_LIST_UNORDERED = 1;
  TEXT_LIST_NONE = 2;
}

enum HyperlinkType {
  HYPERLINK_URL = 0;
  HYPERLINK_NODE = 1;
}

// ============================================================================
// Enums - Paint
// ============================================================================

enum PatternTileType {
  PATTERN_TILE_RECTANGULAR = 0;
  PATTERN_TILE_HORIZONTAL_HEXAGONAL = 1;
  PATTERN_TILE_VERTICAL_HEXAGONAL = 2;
}

enum PatternHorizontalAlignment {
  PATTERN_ALIGN_START = 0;
  PATTERN_ALIGN_CENTER = 1;
  PATTERN_ALIGN_END = 2;
}

// ============================================================================
// Paint Types
// ============================================================================

message Paint {
  oneof type {
    SolidPaint solid = 1;
    LinearGradientPaint linearGradient = 2;
    RadialGradientPaint radialGradient = 3;
    AngularGradientPaint angularGradient = 4;
    DiamondGradientPaint diamondGradient = 5;
    ImagePaint image = 6;
    VideoPaint video = 7;
    PatternPaint pattern = 8;
  }
  bool visible = 10;
  double opacity = 11;
  BlendMode blendMode = 12;
}

message SolidPaint {
  Alias color = 1;
}

message ColorStop {
  double position = 1;
  Alias color = 2;
}

// Base gradient fields are in each gradient message
message LinearGradientPaint {
  Transform gradientTransform = 1;
  repeated ColorStop gradientStops = 2;
}

message RadialGradientPaint {
  Transform gradientTransform = 1;
  repeated ColorStop gradientStops = 2;
}

message AngularGradientPaint {
  Transform gradientTransform = 1;
  repeated ColorStop gradientStops = 2;
}

message DiamondGradientPaint {
  Transform gradientTransform = 1;
  repeated ColorStop gradientStops = 2;
}

message ImageFilters {
  double exposure = 1;
  double contrast = 2;
  double saturation = 3;
  double temperature = 4;
  double tint = 5;
  double highlights = 6;
  double shadows = 7;
}

message ImagePaint {
  ScaleMode scaleMode = 1;
  optional string imageHash = 2;
  optional Transform imageTransform = 3;
  optional double scalingFactor = 4;
  optional double rotation = 5;
  optional ImageFilters filters = 6;
}

message VideoPaint {
  ScaleMode scaleMode = 1;
  optional string videoHash = 2;
  optional Transform videoTransform = 3;
  optional double scalingFactor = 4;
  optional double rotation = 5;
  optional ImageFilters filters = 6;
}

message PatternPaint {
  string sourceNodeId = 1;
  PatternTileType tileType = 2;
  double scalingFactor = 3;
  Offset spacing = 4;
  PatternHorizontalAlignment horizontalAlignment = 5;
}

// Legacy gradient support (kept for backward compatibility)
message Gradient {
  oneof type {
    LinearGradient linear = 1;
    RadialGradient radial = 2;
  }
}

message GradientStop {
  double offset = 1;
  Color color = 2;
}

message LinearGradient {
  repeated GradientStop stops = 1;
  Offset begin = 2;
  Offset end = 3;
}

message RadialGradient {
  repeated GradientStop stops = 1;
  Offset center = 2;
  double radius = 3;
}

// ============================================================================
// Effect Types
// ============================================================================

message Effect {
  oneof type {
    DropShadowEffect dropShadow = 1;
    InnerShadowEffect innerShadow = 2;
    LayerBlurEffect layerBlur = 3;
    BackgroundBlurEffect backgroundBlur = 4;
    ProgressiveBlurEffect progressiveBlur = 5;
    MonotoneNoiseEffect monotoneNoise = 6;
    DuotoneNoiseEffect duotoneNoise = 7;
    MultitoneNoiseEffect multitoneNoise = 8;
    TextureEffect texture = 9;
    GlassEffect glass = 10;
  }
  bool visible = 20;
}

message DropShadowEffect {
  Alias color = 1;
  Offset offset = 2;
  double radius = 3;
  optional double spread = 4;
  BlendMode blendMode = 5;
  optional bool showShadowBehindNode = 6;
}

message InnerShadowEffect {
  Alias color = 1;
  Offset offset = 2;
  double radius = 3;
  optional double spread = 4;
  BlendMode blendMode = 5;
}

message LayerBlurEffect {
  double radius = 1;
}

message BackgroundBlurEffect {
  double radius = 1;
}

message ProgressiveBlurEffect {
  double radius = 1;
  double startRadius = 2;
  Offset startOffset = 3;
  Offset endOffset = 4;
}

message MonotoneNoiseEffect {
  Alias color = 1;
  BlendMode blendMode = 2;
  double noiseSize = 3;
  double density = 4;
}

message DuotoneNoiseEffect {
  Alias color = 1;
  BlendMode blendMode = 2;
  double noiseSize = 3;
  double density = 4;
  Alias secondaryColor = 5;
}

message MultitoneNoiseEffect {
  Alias color = 1;
  BlendMode blendMode = 2;
  double noiseSize = 3;
  double density = 4;
  double opacity = 5;
}

message TextureEffect {
  double noiseSize = 1;
  double radius = 2;
  bool clipToShape = 3;
}

message GlassEffect {
  double lightIntensity = 1;
  double lightAngle = 2;
  double refraction = 3;
  double depth = 4;
  double dispersion = 5;
  double radius = 6;
}

// Legacy blur support (kept for backward compatibility)
message BlurEffect {
  BlurType type = 1;
  double radius = 2;
}

enum BlurType {
  BLUR_TYPE_LAYER = 0;
  BLUR_TYPE_BACKGROUND = 1;
}

// ============================================================================
// Stroke Types
// ============================================================================

message Stroke {
  double topWeight = 1;
  double bottomWeight = 2;
  double leftWeight = 3;
  double rightWeight = 4;
  StrokeJoin join = 5;
  StrokeAlign alignment = 6;
}

// ============================================================================
// Shape Types
// ============================================================================

message Shape {
  oneof type {
    RectangleShape rectangle = 1;
    VectorPathsShape vectorPaths = 2;
    TextShape text = 3;
  }
}

message RectangleShape {
  CornerRadius cornerRadius = 1;
}

message VectorPathsShape {
  repeated VectorPath fill = 1;
  repeated VectorPath stroke = 2;
}

message TextShape {
  repeated TextSpan characters = 1;
  optional TextStyle style = 2;
}

// ============================================================================
// Text Types
// ============================================================================

message FontName {
  string family = 1;
  FontStyle style = 2;
  int32 weight = 3; // 100-900
}

message LetterSpacing {
  double value = 1;
  LetterSpacingUnit unit = 2;
}

message LineHeight {
  oneof type {
    double pixels = 1;
    double percent = 2;
    bool autoHeight = 3;
  }
}

message TextStyle {
  FontName fontName = 1;
  double fontSize = 2;
  LetterSpacing letterSpacing = 3;
  LineHeight lineHeight = 4;
}

message TextSpan {
  string text = 1;
  optional TextStyle style = 2;
}

message TextListOptions {
  TextListType type = 1;
}

message HyperlinkTarget {
  HyperlinkType type = 1;
  string value = 2;
}

message TextDecorationOffset {
  oneof type {
    double pixels = 1;
    double percent = 2;
    bool autoOffset = 3;
  }
}

message TextDecorationThickness {
  oneof type {
    double pixels = 1;
    double percent = 2;
    bool autoThickness = 3;
  }
}

// ============================================================================
// Vector Types
// ============================================================================

message VectorVertex {
  double x = 1;
  double y = 2;
  optional StrokeCap strokeCap = 3;
  optional StrokeJoin strokeJoin = 4;
  optional double cornerRadius = 5;
  optional HandleMirroring handleMirroring = 6;
}

message VectorSegment {
  int32 start = 1;
  int32 end = 2;
  optional Offset tangentStart = 3;
  optional Offset tangentEnd = 4;
}

message VectorRegion {
  WindingRule windingRule = 1;
  repeated VectorLoop loops = 2;
  repeated Paint fills = 3;
  optional string fillStyleId = 4;
}

message VectorLoop {
  repeated int32 indices = 1;
}

message VectorNetwork {
  repeated VectorVertex vertices = 1;
  repeated VectorSegment segments = 2;
  repeated VectorRegion regions = 3;
}

message VectorPath {
  string windingRule = 1;
  string path = 2; // SVG path data
}

// ============================================================================
// Vector Graphics
// ============================================================================

message VectorGraphics {
  oneof type {
    SvgVectorGraphics svg = 1;
  }
}

message SvgVectorGraphics {
  string data = 1;
  Rect viewBox = 2;
}

// ============================================================================
// Layout Types
// ============================================================================

message LayoutConstraints {
  ConstraintType horizontal = 1;
  ConstraintType vertical = 2;
}

message ChildSize {
  double width = 1;
  double height = 2;
  optional ChildSizingMode primaryAxisSizing = 3;
  optional ChildSizingMode counterAxisSizing = 4;
}

message GridTrack {
  optional double size = 1;
  GridTrackSizingMode sizingMode = 2;
}

message LayoutProperties {
  oneof type {
    FreeformLayoutProperties freeform = 1;
    AutoLayoutProperties autoLayout = 2;
    GridLayoutProperties grid = 3;
  }
}

message FreeformLayoutProperties {
  double referenceWidth = 1;
  double referenceHeight = 2;
}

message AutoLayoutProperties {
  double referenceWidth = 1;
  double referenceHeight = 2;
  bool isVertical = 3; // false = horizontal, true = vertical
  PrimaryAxisSizingMode primaryAxisSizingMode = 4;
  CounterAxisSizingMode counterAxisSizingMode = 5;
  LayoutAlign primaryAxisAlignItems = 6;
  LayoutAlign counterAxisAlignItems = 7;
  LayoutWrap layoutWrap = 8;
  EdgeInsets padding = 9;
  double itemSpacing = 10;
  double counterAxisSpacing = 11;
}

message GridLayoutProperties {
  int32 columnCount = 1;
  int32 rowCount = 2;
  repeated GridTrack columns = 3;
  repeated GridTrack rows = 4;
  double columnGap = 5;
  double rowGap = 6;
  EdgeInsets padding = 7;
}

// ============================================================================
// Child Layout Data
// ============================================================================

message ChildLayoutData {
  PositioningMode mode = 1;
  double x = 2;
  double y = 3;
  double width = 4;
  double height = 5;
  ConstraintType horizontalConstraint = 6;
  ConstraintType verticalConstraint = 7;
  optional ChildSizingMode primaryAxisSizing = 8;
  optional ChildSizingMode counterAxisSizing = 9;
  int32 gridColumn = 10;
  int32 gridRow = 11;
  int32 gridColumnSpan = 12;
  int32 gridRowSpan = 13;
}

// ============================================================================
// Label Types (for internationalization)
// ============================================================================

message Label {
  LabelSegment segment = 1;
  repeated LabelVariable variables = 2;
}

message LabelVariable {
  int32 id = 1;
  LabelVariableType variableType = 2;
}

enum LabelVariableType {
  LABEL_VARIABLE_STRING = 0;
  LABEL_VARIABLE_NUMBER = 1;
}

message LabelSegment {
  oneof type {
    StyledSegment styled = 1;
    StaticSegment staticSegment = 2;
    VariableSegment variable = 3;
  }
}

message StyledSegment {
  LabelStyle style = 1;
  Label child = 2;
}

message StaticSegment {
  string text = 1;
}

message VariableSegment {
  int32 variableId = 1;
}

enum LabelStyle {
  LABEL_STYLE_NONE = 0;
  LABEL_STYLE_BOLD = 1;
  LABEL_STYLE_ITALIC = 2;
  LABEL_STYLE_UNDERLINED = 3;
}

// ============================================================================
// Interactions
// ============================================================================

message InteractionEvent {
  string sourceId = 1;
  string sourceName = 2;
  Trigger trigger = 3;
  Action action = 4;
}

message Trigger {
  oneof type {
    OnClickTrigger onClick = 1;
    OnDragTrigger onDrag = 2;
    WhileHoveringTrigger whileHovering = 3;
    WhilePressingTrigger whilePressing = 4;
    KeyGamepadTrigger keyGamepad = 5;
    MouseEnterTrigger mouseEnter = 6;
    MouseLeaveTrigger mouseLeave = 7;
    MouseDownTrigger mouseDown = 8;
    MouseUpTrigger mouseUp = 9;
    DelayTrigger delay = 10;
  }
}

message OnClickTrigger {}
message OnDragTrigger {}
message WhileHoveringTrigger {}
message WhilePressingTrigger {}
message KeyGamepadTrigger {
  repeated string keys = 1;
}
message MouseEnterTrigger {
  optional int64 delayMs = 1;
}
message MouseLeaveTrigger {
  optional int64 delayMs = 1;
}
message MouseDownTrigger {
  optional int64 delayMs = 1;
}
message MouseUpTrigger {
  optional int64 delayMs = 1;
}
message DelayTrigger {
  int64 delayMs = 1;
}

message Action {
  oneof type {
    NavigateAction navigate = 1;
    OpenLinkAction openLink = 2;
    SwapOverlayAction swapOverlay = 3;
    CloseOverlayAction closeOverlay = 4;
    BackAction back = 5;
  }
}

message NavigateAction {
  string destinationId = 1;
}

message OpenLinkAction {
  string url = 1;
}

message SwapOverlayAction {
  string overlayId = 1;
}

message CloseOverlayAction {}

message BackAction {}

// ============================================================================
// Variant Value
// ============================================================================

message VariantValue {
  int32 componentId = 1;
  int32 variantId = 2;
  int32 valueId = 3;
}

// ============================================================================
// Visual Node Types
// ============================================================================

message VisualNode {
  oneof type {
    FrameNode frame = 1;
    GroupNode group = 2;
    RectangleNode rectangle = 3;
    EllipseNode ellipse = 4;
    LineNode line = 5;
    VectorNode vector = 6;
    TextNode text = 7;
    InstanceNode instance = 8;
    BooleanOperationNode booleanOperation = 9;
  }
}

// Common base properties for all nodes
message BaseNodeProperties {
  string id = 1;
  string name = 2;
  bool visible = 3;
  Alias opacity = 4;
  BlendMode blendMode = 5;
}

// Common geometric properties for nodes
message GeometryProperties {
  double x = 1;
  double y = 2;
  double width = 3;
  double height = 4;
  Transform relativeTransform = 5;
  optional Transform absoluteTransform = 6;
  optional Rect absoluteBoundingBox = 7;
  double rotation = 8;
  optional LayoutConstraints constraints = 9;
}

// Properties for nodes with decoration (fills, strokes, effects)
message DecorationProperties {
  repeated Paint fills = 1;
  repeated Paint strokes = 2;
  repeated Effect effects = 3;
  Stroke stroke = 4;
  CornerRadius cornerRadius = 5;
}

// FrameNode - matches Frame widget structure
message FrameNode {
  // Base properties
  string id = 1;
  string name = 2;
  bool visible = 3;
  Alias opacity = 4;
  BlendMode blendMode = 5;
  
  // Geometry
  double x = 6;
  double y = 7;
  double width = 8;
  double height = 9;
  Transform relativeTransform = 10;
  optional Transform absoluteTransform = 11;
  optional Rect absoluteBoundingBox = 12;
  double rotation = 13;
  optional LayoutConstraints constraints = 14;
  
  // Child layout data (for when this node is a child)
  optional ChildLayoutData layoutData = 15;
  
  // Layout (matches LayoutProperties)
  LayoutProperties layout = 16;
  optional ChildSize size = 17;
  
  // Decoration
  repeated Paint fills = 18;
  repeated Paint strokes = 19;
  repeated Effect effects = 20;
  Stroke stroke = 21;
  CornerRadius cornerRadius = 22;
  
  // Frame-specific
  bool clipContent = 23;
  repeated VisualNode children = 24;
  
  // Mask
  optional MaskType maskType = 25;
}

message GroupNode {
  // Base properties
  string id = 1;
  string name = 2;
  bool visible = 3;
  Alias opacity = 4;
  BlendMode blendMode = 5;
  
  // Geometry
  double x = 6;
  double y = 7;
  double width = 8;
  double height = 9;
  Transform relativeTransform = 10;
  optional Transform absoluteTransform = 11;
  optional Rect absoluteBoundingBox = 12;
  double rotation = 13;
  optional LayoutConstraints constraints = 14;
  
  // Child layout data
  optional ChildLayoutData layoutData = 15;
  
  // Children
  repeated VisualNode children = 16;
}

message RectangleNode {
  // Base properties
  string id = 1;
  string name = 2;
  bool visible = 3;
  Alias opacity = 4;
  BlendMode blendMode = 5;
  
  // Geometry
  double x = 6;
  double y = 7;
  double width = 8;
  double height = 9;
  Transform relativeTransform = 10;
  optional Transform absoluteTransform = 11;
  optional Rect absoluteBoundingBox = 12;
  double rotation = 13;
  optional LayoutConstraints constraints = 14;
  
  // Child layout data
  optional ChildLayoutData layoutData = 15;
  
  // Decoration
  repeated Paint fills = 16;
  repeated Paint strokes = 17;
  repeated Effect effects = 18;
  Stroke stroke = 19;
  CornerRadius cornerRadius = 20;
  
  // Mask
  optional MaskType maskType = 21;
}

message EllipseNode {
  // Base properties
  string id = 1;
  string name = 2;
  bool visible = 3;
  Alias opacity = 4;
  BlendMode blendMode = 5;
  
  // Geometry
  double x = 6;
  double y = 7;
  double width = 8;
  double height = 9;
  Transform relativeTransform = 10;
  optional Transform absoluteTransform = 11;
  optional Rect absoluteBoundingBox = 12;
  double rotation = 13;
  optional LayoutConstraints constraints = 14;
  
  // Child layout data
  optional ChildLayoutData layoutData = 15;
  
  // Decoration
  repeated Paint fills = 16;
  repeated Paint strokes = 17;
  repeated Effect effects = 18;
  Stroke stroke = 19;
  
  // Ellipse-specific
  optional ArcData arcData = 20;
  
  // Mask
  optional MaskType maskType = 21;
}

message LineNode {
  // Base properties
  string id = 1;
  string name = 2;
  bool visible = 3;
  Alias opacity = 4;
  BlendMode blendMode = 5;
  
  // Geometry
  double x = 6;
  double y = 7;
  double width = 8;
  double height = 9;
  Transform relativeTransform = 10;
  optional Transform absoluteTransform = 11;
  optional Rect absoluteBoundingBox = 12;
  double rotation = 13;
  optional LayoutConstraints constraints = 14;
  
  // Child layout data
  optional ChildLayoutData layoutData = 15;
  
  // Decoration
  repeated Paint fills = 16;
  repeated Paint strokes = 17;
  repeated Effect effects = 18;
  Stroke stroke = 19;
  
  // Line-specific
  StrokeCap strokeCap = 20;
}

message VectorNode {
  // Base properties
  string id = 1;
  string name = 2;
  bool visible = 3;
  Alias opacity = 4;
  BlendMode blendMode = 5;
  
  // Geometry
  double x = 6;
  double y = 7;
  double width = 8;
  double height = 9;
  Transform relativeTransform = 10;
  optional Transform absoluteTransform = 11;
  optional Rect absoluteBoundingBox = 12;
  double rotation = 13;
  optional LayoutConstraints constraints = 14;
  
  // Child layout data
  optional ChildLayoutData layoutData = 15;
  
  // Decoration
  repeated Paint fills = 16;
  repeated Paint strokes = 17;
  repeated Effect effects = 18;
  Stroke stroke = 19;
  CornerRadius cornerRadius = 20;
  
  // Vector-specific
  optional VectorNetwork vectorNetwork = 21;
  repeated VectorPath fillPaths = 22;
  repeated VectorPath strokePaths = 23;
  
  // Mask
  optional MaskType maskType = 24;
}

message TextNode {
  // Base properties
  string id = 1;
  string name = 2;
  bool visible = 3;
  Alias opacity = 4;
  BlendMode blendMode = 5;
  
  // Geometry
  double x = 6;
  double y = 7;
  double width = 8;
  double height = 9;
  Transform relativeTransform = 10;
  optional Transform absoluteTransform = 11;
  optional Rect absoluteBoundingBox = 12;
  double rotation = 13;
  optional LayoutConstraints constraints = 14;
  
  // Child layout data
  optional ChildLayoutData layoutData = 15;
  
  // Decoration
  repeated Paint fills = 16;
  repeated Paint strokes = 17;
  repeated Effect effects = 18;
  Stroke stroke = 19;
  
  // Text content
  Alias characters = 20;
  repeated TextSpan spans = 21;
  
  // Text style
  TextStyle style = 22;
  TextAlignHorizontal textAlignHorizontal = 23;
  TextAlignVertical textAlignVertical = 24;
  
  // Text decoration
  optional TextDecoration textDecoration = 25;
  optional TextDecorationStyle textDecorationStyle = 26;
  optional TextCase textCase = 27;
  optional TextListOptions listOptions = 28;
  optional HyperlinkTarget hyperlink = 29;
  optional LeadingTrim leadingTrim = 30;
}

message InstanceNode {
  // Base properties
  string id = 1;
  string name = 2;
  bool visible = 3;
  Alias opacity = 4;
  BlendMode blendMode = 5;
  
  // Geometry
  double x = 6;
  double y = 7;
  double width = 8;
  double height = 9;
  Transform relativeTransform = 10;
  optional Transform absoluteTransform = 11;
  optional Rect absoluteBoundingBox = 12;
  double rotation = 13;
  optional LayoutConstraints constraints = 14;
  
  // Child layout data
  optional ChildLayoutData layoutData = 15;
  
  // Layout
  LayoutProperties layout = 16;
  optional ChildSize size = 17;
  
  // Decoration
  repeated Paint fills = 18;
  repeated Paint strokes = 19;
  repeated Effect effects = 20;
  Stroke stroke = 21;
  CornerRadius cornerRadius = 22;
  
  // Frame-specific
  bool clipContent = 23;
  repeated VisualNode children = 24;
  
  // Instance-specific
  optional string mainComponentId = 25;
  repeated ComponentPropertyValue componentProperties = 26;
}

message ComponentPropertyValue {
  string key = 1;
  Value value = 2;
}

message BooleanOperationNode {
  // Base properties
  string id = 1;
  string name = 2;
  bool visible = 3;
  Alias opacity = 4;
  BlendMode blendMode = 5;
  
  // Geometry
  double x = 6;
  double y = 7;
  double width = 8;
  double height = 9;
  Transform relativeTransform = 10;
  optional Transform absoluteTransform = 11;
  optional Rect absoluteBoundingBox = 12;
  double rotation = 13;
  optional LayoutConstraints constraints = 14;
  
  // Child layout data
  optional ChildLayoutData layoutData = 15;
  
  // Decoration
  repeated Paint fills = 16;
  repeated Paint strokes = 17;
  repeated Effect effects = 18;
  Stroke stroke = 19;
  
  // Boolean-specific
  BooleanOperation booleanOperation = 20;
  repeated VisualNode children = 21;
}

enum BooleanOperation {
  BOOLEAN_OPERATION_UNION = 0;
  BOOLEAN_OPERATION_INTERSECT = 1;
  BOOLEAN_OPERATION_SUBTRACT = 2;
  BOOLEAN_OPERATION_EXCLUDE = 3;
}
